package com.south.servlet;

import java.io.IOException;
import java.io.PrintWriter;
import java.net.URLEncoder;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.south.util.WeixinUtil;

/**
 * @author yao
 *用户登录绑定微信，获取code
 */
@WebServlet("/login.do")
public class LoginServlet extends HttpServlet  {

	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		
		
				
		String backUrl="http://daily.s1.natapp.cc/Daily/callBack.do";
		String url="https://open.weixin.qq.com/connect/oauth2/authorize?"
				+ "appid="+WeixinUtil.CORPID
				+ "&redirect_uri="+URLEncoder.encode(backUrl)
				+ "&response_type=code"
				+ "&scope=snsapi_userinfo"
				+ "&agentid="+WeixinUtil.AGENTID
				+ "&state=STATE#wechat_redirect";
		resp.sendRedirect(url);
		
		
		
		
	}

	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		/*resp.setContentType("application/text; charset=utf-8");
        PrintWriter out = resp.getWriter();
		UserDao userDao=new UserDaoImpl();
		//callBack里面的request
		String openid=req.getParameter("openid");
		String name=req.getParameter("realName");
		String nickName=req.getParameter("nickName");
		String tel=req.getParameter("tel");
		String sex=req.getParameter("sex");
		String role_id=req.getParameter("role");
		String department=req.getParameter("department");
		String email=req.getParameter("email");
		//System.out.println(department);
		Role role=new Role();
		role.setRole_id(role_id);
		String role_name=userDao.queryRoleName(role_id);
		role.setRole_name(role_name);
		//System.out.println(role_name);
		String isExist=userDao.queryUser(openid);
		if(isExist.equals(openid)) {
			System.out.println("用户已存在不能存储");
			
			out.write("false");
		}else {
			UserInfo userInfo=new UserInfo();
			//userInfo.setAccount(account);
			userInfo.setName(name);
			userInfo.setNickname(nickName);
			userInfo.setOpenId(openid);
			//userInfo.setPassword(password);
			userInfo.setSex(sex);
			userInfo.setTel(tel);
			userInfo.setRole(role);
			userInfo.setEmail(email);
			userInfo.setDepartment(department);
			userDao.saveUser(userInfo);
		
			
			out.write("true");
		}
		out.flush();
		out.close();*/
	}
	

	private static final long serialVersionUID = -604734374443560038L;

}
